<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Movies Manager</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 5px; }
    .movie { margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
  </style>
</head>
<body>
  <h1>Movies Manager</h1>

  <h3>Добавить фильм</h3>
  <input id="title" placeholder="Название" />
  <input id="year" placeholder="Год" type="number" />
  <input id="rating" placeholder="Рейтинг" type="number" step="0.1" />
  <button onclick="addMovie()">Добавить</button>

  <h3>Список фильмов</h3>
  <div id="movies"></div>

  <script>
    const API_URL = 'https://movies-api-phzu.onrender.com/movies';

    async function fetchMovies() {
      const res = await fetch(API_URL);
      const movies = await res.json();
      const container = document.getElementById('movies');
      container.innerHTML = '';
      movies.forEach(m => {
        const div = document.createElement('div');
        div.className = 'movie';
        div.innerHTML = `
          <b>${m.title}</b> (${m.year}) — Рейтинг: ${m.rating}
          <button onclick="editMovie(${m.id})">Редактировать</button>
          <button onclick="deleteMovie(${m.id})">Удалить</button>
        `;
        container.appendChild(div);
      });
    }

    async function addMovie() {
      const title = document.getElementById('title').value;
      const year = +document.getElementById('year').value;
      const rating = +document.getElementById('rating').value;

      if (!title) { alert("Название обязательно"); return; }

      await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, year, rating })
      });

      document.getElementById('title').value = '';
      document.getElementById('year').value = '';
      document.getElementById('rating').value = '';
      fetchMovies();
    }

    async function deleteMovie(id) {
      await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
      fetchMovies();
    }

    async function editMovie(id) {
      const title = prompt("Новое название фильма:");
      const year = prompt("Новый год:");
      const rating = prompt("Новый рейтинг:");

      if (!title && !year && !rating) return;

      await fetch(`${API_URL}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          title: title || undefined,
          year: year ? +year : undefined,
          rating: rating ? +rating : undefined
        })
      });

      fetchMovies();
    }

    fetchMovies();
  </script>
</body>
</html>